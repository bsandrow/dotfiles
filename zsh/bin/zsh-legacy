#!/bin/sh
#
# zsh-legacy
#   When running in an environment with a mix of newer and older versions of
#   zsh, my .zshrc fails because it attempts to pre-compile the .zshrc file
#   which older versions of zsh don't handle well. [i.e. newer versions detect
#   the mis-match and recompile, older versions segfault]
#
#   This is a way to automatically remove the compiled files and pass through
#   all options to zsh.
#
#   Some examples of where this might be useful:
#       1. Testing a config on newer and older versions as the same user
#       2. A single home directory setup (e.g. NFS mount) where the systems
#          have different versions of zsh installed.
#

echo "Clearing out compiled files..."

[ -f "$HOME/.zshrc.zwc" ] && {
    rm -fv "$HOME/.zshrc.zwc"
}

for compfile in "$HOME/.zsh_cache/*.zwc"
do
    [ -f "$compfile" ] && {
        rm -fv "$compfile"
    }
done

zsh "$@"
