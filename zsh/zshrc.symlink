#----------------------------------------
# Cached Files
#----------------------------------------

zsh_cache=${HOME}/.zsh_cache
mkdir -p $zsh_cache

#-----------------
# Auto-Completion
#-----------------

autoload -U compinit

if [ $UID -eq 0 ]; then
    # we don't want root screwing with the permissions in the $zsh_cache
    # directory.
    compinit
else
    compinit -d $zsh_cache/zcomp-$HOST
fi

#-----------
# Recompile
#-----------

autoload -U zrecompile

if [ $UID -ne 0 ]; then
    for file in ~/.zshrc $zsh_cache/zcomp-$HOST; do
        zrecompile -p $file && rm -f $file.zwc.old
    done
fi

#----------------------------------------
# Load Everything Else
#----------------------------------------
# Note: $ZSH set in zshenv

for zsh_snippet in $ZSH/**/*.zsh; do
    source $zsh_snippet
done

#----------------------------------------
# Local Settings
#----------------------------------------
LOCAL_ZSHRC="$HOME/.local/etc/zsh/zshrc"
if [ -f "$LOCAL_ZSHRC" ]; then
    source "$LOCAL_ZSHRC"
fi

#----------------------------------------
# Inspiration
#----------------------------------------
#
# [1] https://github.com/davedash/zsh.d/blob/2f56ab6cc13fe957a86aa5f23312b635d79ffeda/zshrc
# [2] https://github.com/holman/dotfiles/blob/8bb17ea816dc10fd9fbc48f710dd5a2b270f90fe/zsh/zshrc.symlink
#
# vim: set syntax=zsh et sts=4 ts=4 sw=4 tw=100:
